<%- include('../partials/header') %>

<div class="container my-5">
    <div class="order-details-container">
        <!-- Order Header -->
        <div class="order-header mb-4">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="mb-1">Order Details</h2>
                    <p class="text-muted mb-0">Order #<%= order._id.toString().slice(-8).toUpperCase() %></p>
                </div>
                <a href="/orders" class="btn btn-outline-primary">
                    <i class="fas fa-arrow-left me-2"></i>Back to Orders
                </a>
            </div>
        </div>

        <!-- Order Progress -->
        <div class="order-progress card mb-4">
            <div class="card-body">
                <div class="progress-tracker">
                    <% statusStages.forEach((stage, index) => { %>
                        <div class="progress-step <%= order.status === stage ? 'active' : 
                            statusStages.indexOf(order.status) > index ? 'completed' : '' %>">
                            <div class="step-icon">
                                <% if (statusStages.indexOf(order.status) > index) { %>
                                    <i class="fas fa-check"></i>
                                <% } else { %>
                                    <i class="fas <%= 
                                        stage === 'Pending' ? 'fa-clock' :
                                        stage === 'Processing' ? 'fa-cog' :
                                        stage === 'Shipped' ? 'fa-truck' :
                                        'fa-box-check'
                                    %>"></i>
                                <% } %>
                            </div>
                            <span class="step-label"><%= stage %></span>
                        </div>
                        <% if (index < statusStages.length - 1) { %>
                            <div class="progress-line"></div>
                        <% } %>
                    <% }) %>
                </div>
                <div class="delivery-info text-center mt-3">
                    <% if (order.status === 'Delivered') { %>
                        <p class="text-success mb-0">
                            <i class="fas fa-check-circle me-2"></i>
                            Delivered on <%= order.deliveredAt?.toLocaleDateString() %>
                        </p>
                    <% } else { %>
                        <p class="text-muted mb-0">
                            <i class="fas fa-truck me-2"></i>
                            Expected delivery by <%= expectedDate %>
                        </p>
                    <% } %>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Order Items -->
            <div class="col-lg-8">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">Order Items</h5>
                    </div>
                    <div class="card-body">
                        <% order.items.forEach(item => { %>
                            <div class="order-item">
                                <div class="d-flex gap-3">
                                    <div class="item-image">
                                        <img src="<%= item.product.images.image1 %>" 
                                             alt="<%= item.product.name %>">
                                    </div>
                                    <div class="item-details flex-grow-1">
                                        <div class="d-flex justify-content-between">
                                            <h6 class="item-name mb-1"><%= item.product.name %></h6>
                                            <span class="item-price">₹<%= item.price * item.quantity %></span>
                                        </div>
                                        <p class="item-meta mb-1">
                                            Size: <%= item.variant %>
                                            <% if (item.product.brand) { %>
                                                <span class="dot">•</span>
                                                <%= item.product.brand %>
                                            <% } %>
                                        </p>
                                        <p class="text-muted mb-0">
                                            Quantity: <%= item.quantity %> × ₹<%= item.price %>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        <% }); %>
                    </div>
                </div>
            </div>

            <!-- Order Summary -->
            <div class="col-lg-4">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">Order Summary</h5>
                    </div>
                    <div class="card-body">
                        <div class="summary-item d-flex justify-content-between mb-2">
                            <span>Order Date</span>
                            <span><%= orderDate %></span>
                        </div>
                        <div class="summary-item d-flex justify-content-between mb-2">
                            <span>Payment Method</span>
                            <span class="text-capitalize"><%= order.paymentMethod %></span>
                        </div>
                        <div class="summary-item d-flex justify-content-between mb-2">
                            <span>Payment Status</span>
                            <span class="badge <%= 
                                order.paymentStatus === 'Completed' ? 'bg-success' :
                                order.paymentStatus === 'Failed' ? 'bg-danger' :
                                'bg-warning'
                            %>">
                                <%= order.paymentStatus %>
                            </span>
                        </div>
                        <hr>
                        <div class="summary-total d-flex justify-content-between">
                            <span>Total Amount</span>
                            <span class="fw-bold">₹<%= order.total %></span>
                        </div>
                    </div>
                </div>

                <!-- Delivery Address -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Delivery Address</h5>
                    </div>
                    <div class="card-body">
                        <h6 class="mb-1"><%= order.address.name %></h6>
                        <p class="mb-1"><%= order.address.street %></p>
                        <p class="mb-1"><%= order.address.city %>, <%= order.address.state %></p>
                        <p class="mb-1">PIN: <%= order.address.pinCode %></p>
                        <p class="mb-0">Phone: <%= order.address.phone %></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
:root {
    --primary-color: #FF9800;
    --primary-light: #FFB74D;
    --primary-dark: #F57C00;
    --success-color: #4CAF50;
    --warning-color: #FFC107;
    --danger-color: #f44336;
}

.order-header {
    background: linear-gradient(135deg, var(--primary-light), var(--primary-color));
    padding: 2rem;
    border-radius: 12px;
    color: white;
}

.progress-tracker {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 0;
}

.progress-step {
    display: flex;
    flex-direction: column;
    align-items: center;
    flex: 1;
    position: relative;
}

.step-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #f5f5f5;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #666;
    margin-bottom: 0.5rem;
    position: relative;
    z-index: 1;
}

.progress-step.active .step-icon {
    background: var(--primary-color);
    color: white;
}

.progress-step.completed .step-icon {
    background: var(--success-color);
    color: white;
}

.progress-line {
    flex: 1;
    height: 3px;
    background: #f5f5f5;
    margin: 0 8px;
    position: relative;
    top: -40px;
    z-index: 0;
}

.step-label {
    font-size: 0.85rem;
    color: #666;
}

.progress-step.active .step-label {
    color: var(--primary-color);
    font-weight: 500;
}

.progress-step.completed .step-label {
    color: var(--success-color);
}

.order-item {
    padding: 1rem;
    border-bottom: 1px solid #eee;
}

.order-item:last-child {
    border-bottom: none;
}

.item-image {
    width: 80px;
    height: 80px;
    border-radius: 8px;
    overflow: hidden;
}

.item-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.item-price {
    color: var(--primary-color);
    font-weight: 500;
}

.dot {
    margin: 0 0.5rem;
    color: #999;
}

@media (max-width: 768px) {
    .progress-tracker {
        flex-direction: column;
        gap: 1rem;
    }

    .progress-line {
        width: 3px;
        height: 20px;
        margin: 8px 0;
        top: 0;
    }

    .step-icon {
        width: 35px;
        height: 35px;
        font-size: 0.9rem;
    }

    .item-image {
        width: 60px;
        height: 60px;
    }
}
</style>

<%- include('../partials/footer') %> 